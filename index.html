<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Star Trek: Ultimate Challenge LCARS Edition</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">
<style>
body {
    margin:0; font-family:'Orbitron', sans-serif;
    background:black; color:#00ffff;
    overflow-x:hidden;
}
#warp-background {
    position:fixed; top:0; left:0;
    width:100%; height:100%;
    background:#000 url('https://i.imgur.com/HBwlR7I.gif') center center/cover no-repeat;
    z-index:-1;
}
.screen { display:none; padding:20px; }
.active { display:block; }
h1,h2 { text-transform:uppercase; letter-spacing:2px; }
button {
    padding:12px 20px; margin:8px;
    font-size:16px; text-transform:uppercase;
    border:none; cursor:pointer; border-radius:4px;
}
#answers button { width:90%; display:block; margin:10px auto; }
#answers button.correct { background:#00ff00; color:black; }
#answers button.incorrect { background:#ff0000; color:white; }
input { padding:12px; font-size:18px; width:80px; text-align:center; text-transform:uppercase; }
.progress-container { width:80%; margin:15px auto; background:#222; border:2px solid #00ffff; border-radius:5px; }
.progress-bar { height:20px; width:0%; background:#00ffff; border-radius:3px; }
.fanfare { font-size:32px; color:gold; animation:flash 1s infinite; }
@keyframes flash {0%,50%,100%{color:gold;}25%,75%{color:#fff;}}
.lcars-panel { border:4px solid #00ffff; padding:20px; margin:10px auto; border-radius:15px; background:rgba(0,0,0,0.6);}
audio { display:none; }
</style>
</head>
<body>

<div id="warp-background"></div>

<!-- INTRO -->
<div id="intro" class="screen active lcars-panel">
    <h1>STAR TREK: ULTIMATE CHALLENGE</h1>
    <p>50 questions spanning all eras.<br>Score ≥80% = STARFLEET MASTER!</p>
    <input id="initials" maxlength="3" placeholder="ABC">
    <br><br>
    <button onclick="startQuiz()">ENGAGE</button>
</div>

<!-- QUIZ -->
<div id="quiz" class="screen lcars-panel">
    <h2 id="question"></h2>
    <div id="answers"></div>
    <div class="progress-container"><div id="progress" class="progress-bar"></div></div>
    <p id="scoreDisplay"></p>
    <div class="progress-container">
        <div id="timer-bar" class="progress-bar" style="background:#ff9900;"></div>
    </div>
</div>

<!-- RESULT -->
<div id="result" class="screen lcars-panel">
    <h1>MISSION COMPLETE</h1>
    <p id="finalScore"></p>
    <div id="celebration"></div>
    <button onclick="restart()">Try Again</button>
    <div class="leaderboard">
        <h3>Leaderboard</h3>
        <div id="leaderboard"></div>
    </div>
</div>

<!-- SOUND EFFECTS -->
<audio id="correct-sound" src="https://freesound.org/data/previews/320/320181_4939433-lq.mp3"></audio>
<audio id="wrong-sound" src="https://freesound.org/data/previews/320/320182_4939433-lq.mp3"></audio>
<audio id="fanfare-sound" src="https://freesound.org/data/previews/316/316847_4939433-lq.mp3"></audio>

<script>
// --- QUIZ DATA ---
const quizData = [
  // [same 50 questions array as before...]
  // shortened for brevity in this snippet; plug in the previous 50 questions
];

// Shuffle helper
function shuffle(array){for(let i=array.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[array[i],array[j]]=[array[j],array[i]];}return array;}

let currentQuestion=0, score=0, playerInitials="", timer, timeLeft=20;

// START
function startQuiz(){
    const input=document.getElementById("initials").value.trim().toUpperCase();
    if(!/^[A-Z]{2,3}$/.test(input)){alert("Enter 2–3 letters."); return;}
    playerInitials=input;
    shuffle(quizData);
    document.getElementById("intro").classList.remove("active");
    document.getElementById("quiz").classList.add("active");
    currentQuestion=0; score=0;
    loadQuestion();
}

// LOAD QUESTION
function loadQuestion(){
    clearInterval(timer);
    timeLeft=20;
    updateTimer();
    const q=quizData[currentQuestion];
    document.getElementById("question").textContent=q.question;
    const answersDiv=document.getElementById("answers");
    answersDiv.innerHTML="";
    q.answers.forEach((answer,index)=>{
        const btn=document.createElement("button");
        btn.textContent=answer;
        btn.onclick=()=>checkAnswer(index);
        answersDiv.appendChild(btn);
    });
    updateProgress();
    updateScore();
    timer=setInterval(()=>{
        timeLeft--;
        updateTimer();
        if(timeLeft<=0){clearInterval(timer);checkAnswer(-1);}
    },1000);
}

function updateTimer(){
    const percent=(timeLeft/20)*100;
    document.getElementById("timer-bar").style.width=percent+"%";
}

// CHECK ANSWER
function checkAnswer(index){
    clearInterval(timer);
    const buttons=document.querySelectorAll("#answers button");
    const correctIndex=quizData[currentQuestion].correct;
    buttons.forEach((b,i)=>{
        b.disabled=true;
        if(i===correctIndex) b.classList.add("correct");
        if(i===index && i!==correctIndex) b.classList.add("incorrect");
    });
    if(index===correctIndex) {score++;document.getElementById("correct-sound").play();}
    else document.getElementById("wrong-sound").play();
    setTimeout(()=>{
        currentQuestion++;
        if(currentQuestion<quizData.length) loadQuestion();
        else endQuiz();
    },1000);
}

function updateProgress(){document.getElementById("progress").style.width=(currentQuestion/quizData.length*100)+"%";}
function updateScore(){document.getElementById("scoreDisplay").textContent=`Score: ${score} / ${quizData.length}`;}

// END
function endQuiz(){
    document.getElementById("quiz").classList.remove("active");
    document.getElementById("result").classList.add("active");
    const percent=Math.round((score/quizData.length)*100);
    document.getElementById("finalScore").textContent=`${playerInitials} scored ${score}/${quizData.length} (${percent}%)`;
    if(percent>=80){
        document.getElementById("celebration").innerHTML=`<div class="fanfare">STARFLEET MASTER ACHIEVED</div>`;
        document.getElementById("fanfare-sound").play();
    }else document.getElementById("celebration").textContent="Keep training for Starfleet mastery!";
    saveScore(playerInitials,percent);
    displayLeaderboard();
}

// LEADERBOARD
function saveScore(initials,percent){
    const lb=JSON.parse(localStorage.getItem("leaderboard"))||[];
    lb.push({initials,percent});
    lb.sort((a,b)=>b.percent-a.percent);
    localStorage.setItem("leaderboard",JSON.stringify(lb.slice(0,10)));
}
function displayLeaderboard(){
    const lb=JSON.parse(localStorage.getItem("leaderboard"))||[];
    const div=document.getElementById("leaderboard"); div.innerHTML="";
    lb.forEach(e=>div.innerHTML+=`<p>${e.initials} — ${e.percent}%</p>`);
}

// RESTART
function restart(){
    document.getElementById("intro").classList.add("active");
    document.getElementById("result").classList.remove("active");
    document.getElementById("initials").value="";
    document.getElementById("celebration").innerHTML="";
    document.getElementById("progress").style.width="0%";
    document.getElementById("scoreDisplay").textContent="";
    document.getElementById("timer-bar").style.width="100%";
}
</script>
</body>
</html>
